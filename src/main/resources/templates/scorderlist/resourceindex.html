<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <title>超量资源管理</title>
    <script th:src="@{/js/jquery-3.2.1.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/ajax.js}"></script>
    <script language="javascript" type="text/javascript" th:src="@{/js/My97DatePicker/WdatePicker.js}"></script>
    <script type="text/javascript" th:src="@{/js/layui/layui.all.js}"></script>
    <link th:href="@{/js/layui/css/layui.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/css/base.css}" rel="stylesheet" type="text/css"/>
    <script th:src="@{/js/chosen.js}" type="text/javascript"></script>
    <link th:href="@{/css/chosen.css}" rel="stylesheet" type="text/css"/>
    <meta content="text/html; charset=utf-8" http-equiv=Content-Type>
    <meta http-equiv="X-UA-Compatible" content="IEedge">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <style>
        .steel_list_table input[type="text"] {
            border: 1px solid #dedede;
            padding: 1px 2px;
            width: 80px;
            height: 22px;
        }

       
        .steel_list_table td {
            background:none;
            border-top: 1px solid #dddddd;
            font-size: 14px;
            text-align: center;
            height: 40px;
            border-right: 1px solid #dddddd;
        }


        table td a {
            background: #F7836A;
            padding: 6px 5px;
            color: #fff;
        }
        #saveBtn{background: #007FFF;}

        .steel_list_table tbody tr:hover td{ background:none;}
        table    a:hover {color: #ffffff;}
        .confirm{text-align: center;}
        .order_confirm{background: #fff;}
        .order_confirm div {float: left;width: 100%;}
        .ee{background: #EAEAEA;}
        .ee input{pointer-events: none;}
        .ee a{pointer-events: none;background: #ccc;}
        .ee a#saveBtn{pointer-events: none;background: #ccc;}
    </style>
</head>
<body onload="onload();">
<div th:insert="~{header :: header}"></div>

<section>
    <div class="main w1000">
        <div th:insert="~{left :: left('resourceindex')}"></div>
        <aside>
            <div class="resources">
                <div class="resources_tt" th:include="common::varietyTag2"></div>

                <div class="pozition">
                    <p>当前位置：会员中心 &gt; 资源管理 &gt; 超量资源管理</p>
                </div>

                <section>
                    <div class="steel_list w830">
                        <div class="ss">
                            <form name="form1" id="form1" th:action="@{'/scorderlist/resourceIndex'}" method="post">
                                <table cellspacing="0" cellpadding="0" border="0">
                                    <tbody>
                                    <tr>
                                        <td><p>品名：</p><input type="text" name="varietyName" id="varietyName"
                                                             th:value="${scShelfResource.varietyName}" size="18"></td>
                                        <td><p>材质：</p><input type="text" name="material" id="material"
                                                             th:value="${scShelfResource.material}" size="18"></td>
                                        <td><p>规格：</p><input type="text" name="specification" id="specification"
                                                             th:value="${scShelfResource.specification}" size="18">
                                            <p></td>
                                    </tr>
                                    <tr>
                                        <td><p>产地：</p><input type="text" name="factory" id="factory"
                                                             th:value="${scShelfResource.factory}" size="18"></td>
                                        <td><p>仓库：</p><input type="text" name="warehouse" id="warehouse"
                                                             th:value="${scShelfResource.warehouse}" size="18"></td>
                                        <input type="hidden" name="page" id="page"/>
                                        <td>
                                            <p>日期：</p>
                                            <input type="text" name="stime" id="stime" style="width:140px" class="Wdate" onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" th:value="${stime}" autocomplete="off" size="18">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><p>订单号：</p><input type="text" name="orderId" id="orderId"
                                            th:value="${orderId}" size="20"></td>

                                        <td  style="position:relative;" id="searchtd" colspan="2">
                                            <div class="searchBox">
                                               <p>公司：</p>  <input type="text" autocomplete="off"  id="cameName" value="" name="companyname" placeholder="请输入公司名称" onkeyup="getCameraNames()"  style="width:220px;" />
                                               <input type="hidden" name="companyid" id="companyid" value="">

                                               <input type="hidden" id="parameterName" th:value="${_csrf.parameterName}">
                                               <input type="hidden" id="token" th:value="${_csrf.token}">

                                            </div>
                                            <!--搜索提示框 -->
                                            <div class="searchDiv">
            
                                            </div>
                                            <div  id="dataList"  style="display:none;" >
                                                <p th:each="item:${tmpcompay}" th:id="${item.id}" th:text="${item.comname}"></p>
                                            </div>

                                            <a href="javascript:find();" style="padding: 0px;">搜索</a>
                                        </td>
                                        
                                    </tbody>
                                </table>
                            </form>
                        </div>
                        
                            <table class="steel_list_table w830" cellspacing="0" cellpadding="0" border="0" id="stab">
                                <thead>
                                <tr>
                                    <td>品名</td>
                                    <td>材质</td>
                                    <td>规格</td>
                                    <td>产地</td>
                                    <td>仓库</td>
                                    <td>数量</td>
                                    <td>公司名称</td>
                                    <td>订单量</td>
                                    <td width="100px">拆分</td>
                                    <td>合计</td>
                                    <!--<td>分配量</td>-->
                                    <td width="60px">采购量</td>
                                    <!--<td width="100px">采购拆分</td>-->
                                    <td th:if="${today} eq 1"  width="80px">操作</td>
                                    <td th:if="${today} eq 1" width="60px">保存</td>
                                </tr>
                                </thead>
                                <tbody th:each="list:${scResourceList}"  th:id="'tbody_'+${list.id}"  th:class="${iskcf[list.id]}  eq '1' or ${list.ScOrderListDetail[0].existSaveAction} eq 3 ? 'ee':''" >
                                    <tr th:if="${#lists.size(list.ScOrderListDetail)} gt 1" th:id="'str_'+${list.id}">
                                        <td th:rowspan="${#lists.size(list.ScOrderListDetail)}+1" th:text="${list.varietyName}" ></td>
                                        <td th:rowspan="${#lists.size(list.ScOrderListDetail)}+1" th:text="${list.material}" ></td>
                                        <td th:rowspan="${#lists.size(list.ScOrderListDetail)}+1" th:text="${list.specification}" ></td>
                                        <td th:rowspan="${#lists.size(list.ScOrderListDetail)}+1" th:text="${list.factory}" ></td>
                                        <td th:rowspan="${#lists.size(list.ScOrderListDetail)}+1" th:text="${list.warehouse}" ></td>
                                        <td th:rowspan="${#lists.size(list.ScOrderListDetail)}+1" th:text="${list.num}" ></td>
                                        <input type="hidden" th:name="'ids['+${list.id}+'][]'" th:value="${list.id}" />
                                    </tr>

                                <tr th:each="detail,state:${list.ScOrderListDetail}" th:id="'tr_'+${detail.id}">

                                    <td  th:if="${state.index} eq 0 and ${state.size} eq 1 " th:rowspan="${#lists.size(list.ScOrderListDetail)}" th:text="${list.varietyName}" ></td>
                                    <td  th:if="${state.index} eq 0 and ${state.size} eq 1 " th:rowspan="${#lists.size(list.ScOrderListDetail)}" th:text="${list.material}" ></td>
                                    <td  th:if="${state.index} eq 0 and ${state.size} eq 1 " th:rowspan="${#lists.size(list.ScOrderListDetail)}" th:text="${list.specification}" ></td>
                                    <td  th:if="${state.index} eq 0 and ${state.size} eq 1 " th:rowspan="${#lists.size(list.ScOrderListDetail)}" th:text="${list.factory}" ></td>
                                    <td  th:if="${state.index} eq 0 and ${state.size} eq 1 " th:rowspan="${#lists.size(list.ScOrderListDetail)}" th:text="${list.warehouse}" ></td>
                                    <td  th:if="${state.index} eq 0 and ${state.size} eq 1 " th:rowspan="${#lists.size(list.ScOrderListDetail)}" th:text="${list.num}" ></td>
                                    <input th:if="${state.index} eq 0 and ${state.size} eq 1 " type="hidden" th:name="'ids['+${list.id}+'][]'" th:value="${list.id}" />

                                    <td><p  th:text="${commap[detail.purchaseMid]}"></p><span>(</span><span style="color: red;" th:text="${detail.orderBaseid}"></span><span>)</span> </td>
                                    <td th:if="${list.vid} eq 1"  th:text="${detail.extractPiece}"></td>
                                    <td th:if="${list.vid ne 1}"  th:text="${detail.extractNum}"></td>

                                    

                                    <td><input type="text" th:id="'resource_'+${detail.id}" th:name="'resource['+${list.id}+'][]'" th:onkeyup="'check_num(this,\''+${list.id}+'\');'" th:value="${thd[detail.id]}"  th:readonly="${today eq 1}?false:true"/></td>
                                   
                                   
                                    <td  th:if="${state.index} eq 0 " th:rowspan="${#lists.size(list.ScOrderListDetail)}"><input type="text" style="width: 35px;padding: 0px;"  th:id="'sum_'+${list.id}" th:value="${detail.existSaveAction} eq 3 ?${list.num}:''"  readonly/></td>
                                    <!--<td><input type="hidden" style="width: 55px;padding: 0px;"  th:id="'purchase_'+${detail.id}" th:name="'purchase['+${list.id}+'][]'" th:value="${cgnum[detail.id]}" readonly/><input type="text" style="width: 55px;padding: 0px;"  th:id="'heji_'+${detail.id}" th:name="'heji['+${list.id}+'][]'" th:value="${heji[detail.id]}" readonly/></td>-->
                                    
                                    
                                    <td><input type="hidden" th:id="'cg_'+${detail.id}" th:name="'cg['+${list.id}+'][]'" th:onkeyup="'check_cg(this,\''+${detail.id}+'\');'"  th:value="${cgd[detail.id]}" th:readonly="${today eq 1} and (${shenhe[list.id]} eq 2 or ${shenhe[list.id]} eq 0)?false:true"/><input type="text" style="width: 55px;padding: 0px;"  th:id="'purchase_'+${detail.id}" th:name="'purchase['+${list.id}+'][]'" th:value="${cgnum[detail.id]}" readonly/></td>




                                    
                                   
                                    <td th:if="${today} eq 1"> <div th:if="${shenhe[list.id]} eq 2 or ${shenhe[list.id]} eq 0" id="closeBtn"><a href="javascript:void(0)"  th:onclick="'quxiao(1,\''+${detail.id}+'\');'"  th:style="${detail.existSaveAction} eq 3 ? 'pointer-events: none;background: #ccc;':''"  >取消资源</a><a href="javascript:void(0)"  th:onclick="'quxiao(2,\''+${detail.id}+'\');'" th:style="${detail.existSaveAction} eq 3 ? 'pointer-events: none;background: #ccc;':''" >取消订单</a></div></td>

                                    <td th:if="${state.index} eq 0 and ${today} eq 1" th:rowspan="${#lists.size(list.ScOrderListDetail)}+1"><font th:id="'btn_'+${list.id}" style="color: red;" th:text="${detail.existSaveAction} eq 3 ?'已拆分':''"></font>  <a th:if="${detail.existSaveAction} eq 2 or ${detail.existSaveAction} eq 3"    href="javascript:void(0)"    th:onclick="'baocun(\''+${list.id}+'\');'"  id="saveBtn">保 存</a></td>
                                </tr>
                                </tbody>
                            </table>

                        <div style="clear:both"></div>
                    </div>
                </section>

                <div  style="margin-bottom: 10px;color: red;margin-top: 10px;">注：灰底未拆分资源，说明该资源还有待确认、待付款订单。</div>


            </div>

           

        </aside>
    </div>
</section>



<div th:insert="~{footer :: footer}"></div>
<div th:include="common::commonFooter"></div>
</body>

<script>

    var resIds="[[${resIds}]]",detailIds="[[${detailIds}]]",extractIds="[[${extractIds}]]";
    resIds=resIds.replace(new RegExp("&quot;",("gm")),'"'),detailIds=detailIds.replace(new RegExp("&quot;",("gm")),'"'),extractIds=extractIds.replace(new RegExp("&quot;",("gm")),'"');
    resIds=JSON.parse(resIds),detailIds=JSON.parse(detailIds),extractIds=JSON.parse(extractIds);
    
    var obj=document.getElementById("tr_501");
   

    
    
    
    function quxiao(index,detail_id){

       // removestr(obj);
         if (confirm("确定取消？")){
            $.ajax({
                type: "POST",
                url: "/scorderlist/delete_order_resource",
                dataType: "json",
                async:false,
                data: {
                    "index":index,
                    "detail_id":detail_id,
                    "[[${_csrf.parameterName}]]": "[[${_csrf.token}]]"
                },
                success: function (result) {
                    console.log(result);
                    if(result["data"]==1){
                        alert("订单其他资源已拆分，无法取消订单");
                    }else if(result["data"]==2){
                        alert("已取消,资源为非超量销售");
                    }else if(result["data"]==3){
                        alert("已取消！");

                        /*if(result["trs"]!=""){
                            var cl_sold=result["cl_sold"].split(",");
                            for(let x=0;x<cl_sold.length;x++){
                                document.getElementById("str_"+cl_sold[x]).style.borderColor="red";
                            }
                        }*/
                    }

                    console.log(result["trs"]);

                    if(result["tbodys"]!="" && result["tbodys"]!=undefined){
                        for(let y=0;y<result["tbodys"].length;y++){
                            if(document.getElementById("tbody_"+result["tbodys"][y])!=undefined){
                                document.getElementById("tbody_"+result["tbodys"][y]).remove();
                            }
                            
                        }
                    }
                    if(result["trs"]!="" && result["trs"]!=undefined){
                        for(let y=0;y<result["trs"].length;y++){
                           

                            var obj=document.getElementById("tr_"+result["trs"][y]);
                            /*if(obj.parentNode.children.length>2){
                                var tt=obj.children[obj.children.length-1];
                                obj.parentNode.children[2].append(tt);
                                document.getElementById("tr_"+result["trs"][y]).remove();
                                var rr=obj.children[3];
                                var x=obj.parentNode.children[2].insertCell(3);
                                x.innerHTML=rr;
                                
                            }else{
                                obj.parentNode.remove();
                            }*/

                            if(obj.parentNode.children.length>2){
                                var parent=obj.parentNode.children;
                                var index = Array.prototype.indexOf.call(parent,obj);
                                console.log(index);
                                if(index==1){
                                    var tt=obj.children[obj.children.length-1];
                                    obj.parentNode.children[2].append(tt);
                                    var rr=obj.children[3];
                                    $(rr).insertAfter(obj.parentNode.children[2].children[2]);
                                
                                }
                                document.getElementById("tr_"+result["trs"][y]).remove();
                            }else{
                                obj.parentNode.remove();
                            }

                        }
                    }
                    
                }
            });
        }
    }






    function check_cg(obj,did){
        var cg_num=$("#purchase_"+did).val();
        var cg_arr=obj.value.split(",");
        var res_sum=0;
        for(let i = 0; i < cg_arr.length; i++){
            res_sum=accAdd(res_sum,cg_arr[i]);
        }
        if(res_sum!=cg_num){
            alert("采购拆分量不等于采购量，请核对重新填写");
            $("#cg_"+did).css('border-color', "red");
        }else{
            $("#cg_"+did).css('border-color', "#dedede");
        }
    }
    
    function check_num(obj,rid){
        var id_arr=obj.id.split("_");
        var did=id_arr[1];
        var sum=0;
        var num_arr=obj.value.split(",");
        $("#purchase_"+did).val("");
        $("#cg_"+did).val("");
        $("#heji_"+did).val("");
        var extract_arr=extractIds[did].split(",");


        if(num_arr.length>1){
            for(let i = 0; i < num_arr.length; i++){
                var flag=true;
                for(let k = 0; k < extract_arr.length; k++){
                    if(num_arr[i]==extract_arr[k]){
                        flag=false;
                    }    
                }

                if(flag && i<num_arr.length-1){
                    alert("拆分请先匹配某个提货单再填写下一个");
                    $("#resource_"+did).css('border-color', "red");
                    //console.log("######"+did);
                    return false;
                }else{
                    $("#resource_"+did).css('border-color', "#dedede");
                }
            }
            
        }
        
        
        for(let j = 0; j < num_arr.length; j++){
            sum=accAdd(sum,num_arr[j]);
        }
        if(sum>detailIds[did]){
            alert("分配资源量大于订单量！");
            obj.value="";
            $("#purchase_"+did).val("");
            $("#cg_"+did).val("");
            $("#heji_"+did).val("");
        }

        if(detailIds[did]>sum){
            var cg_num=accSub(detailIds[did],sum);
            $("#purchase_"+did).val(cg_num);
            $("#heji_"+did).val(sum);
           
            var newArr = new Array(extract_arr.length);
            var newArr2 = new Array();
            for(let m = 0; m< num_arr.length; m++){
                var flag2=true;
                for(let n = 0; n< extract_arr.length; n++){
                    if( extract_arr[n]==(num_arr[m]) && flag2){
                        //if(newArr[n]=="" || (newArr[n]!="" && newArr[n]!=num_arr[m]) ){
                            //newArr[n]=num_arr[m];
                            extract_arr.splice(n,1);
                            flag2=false;
                        //}
                    }
                }
                if(flag2){
                    newArr2.push(num_arr[m]);
                }
            }
            extract_arr=extract_arr.sort((a,b) => a - b);

            for(let h=0;h<extract_arr.length;h++){
                
                if(newArr2.length>0 &&  newArr2[0]!="" && extract_arr[h]>=0    ){  //&& extract_arr[h]>=newArr2[0]
                   
                    var sub=accSub(extract_arr[h],newArr2[0]);
                    if(h<extract_arr.length-1){
                        if(h==0){
                            extract_arr[h+1]=accAdd(extract_arr[h+1],sub);
                            extract_arr.splice(0,1);
                        }else{
                            extract_arr.splice(h,1);
                            extract_arr[0]=accAdd(extract_arr[0],sub);
                        }
                    }else{
                        if(h==0){
                            extract_arr[0]=sub;
                        }else{
                            extract_arr[0]=accAdd(extract_arr[0],sub);
                            extract_arr.splice(h,1);
                        }
                    }
                    break;
                }
            }
            $("#cg_"+did).val(extract_arr.toString());
        }

        var rids=document.getElementsByName("resource["+rid+"][]");
        var res_sum=0;
        for (let i = 0; i < rids.length; i++) {
            var id_arr=rids[i].id.split("_");
            var did=id_arr[1];
            var num_arr=rids[i].value.split(",");
            for(let j = 0; j < num_arr.length; j++){
                res_sum=accAdd(res_sum,num_arr[j]);
            }
        }

        if(res_sum>resIds[rid] && res_sum>0){
            alert("分配资源量大于资源数量！");
            for(var i=0;i<rids.length;i++){
                rids[i].style.borderColor = "red";
            }
        }else{
            $("#sum_"+rid).val(res_sum);
        }
    }


    function baocun(rid){
        var rids=document.getElementsByName("resource["+rid+"][]");
        var res_sum=0;
        for (let i = 0; i < rids.length; i++) {
            var sum=0;
            var id_arr=rids[i].id.split("_");
            var did=id_arr[1];
            var num_arr=rids[i].value.split(",");
            for(let j = 0; j < num_arr.length; j++){
                sum=accAdd(sum,num_arr[j]);
                res_sum=accAdd(res_sum,num_arr[j]);
            }
            if(sum>detailIds[did]){
                flag=true;
                emptyArr.push(did);
            }

            if(rids[i].value==""){ 
                $("#purchase_"+did).val( detailIds[did]);
                $("#cg_"+did).val(extractIds[did]);
            }
            //manage.push([did,rids[i].value]);
        }

        

        if(res_sum!=resIds[rid] ){
            alert("分配资源量不等于资源数量！");
            for(var i=0;i<rids.length;i++){
                rids[i].style.borderColor = "red";
            }
            return false;
        }

       
        var cgs=document.getElementsByName("cg["+rid+"][]");
        var res_sum=0,thd_list=[],cgd_list=[];
        for (let i = 0; i < cgs.length; i++) {
            var sum=0;
            var id_arr=cgs[i].id.split("_");
            var did=id_arr[1];
            var num_arr=cgs[i].value.split(",");
            for(let j = 0; j < num_arr.length; j++){
                sum=accAdd(sum,num_arr[j]);
                res_sum=accAdd(res_sum,num_arr[j]);
            }
            var cg_num=$("#purchase_"+did).val();
            if(sum!=cg_num){
                alert("采购拆分量不等于采购量，请核对重新填写");
                $("#cg_"+did).css('border-color', "red");
            }else{
                $("#cg_"+did).css('border-color', "#dedede");
            }

            if(cgs[i].value!="" && cgs[i].value!=0){
                cgd_list.push([did,cgs[i].value]);
            }
            //if(rids[i].value!="" && rids[i].value!=0){
                thd_list.push([did,rids[i].value]);
            //}

        }


        var purchases=document.getElementsByName("purchase["+rid+"][]");
        var pur_sum=0;
        for (let i = 0; i < purchases.length; i++) {
            pur_sum=accAdd(pur_sum,purchases[i].value);
        }

        
        $.ajax({
            type: "POST",
            url: "/scorderlist/setPurchaseList",
            dataType: "json",
            async:false,
            data: {
                "cgd_list":JSON.stringify(cgd_list),
                "thd_list":JSON.stringify(thd_list),
                "pur_sum":pur_sum,
                "rid":rid,
                "[[${_csrf.parameterName}]]": "[[${_csrf.token}]]"
            },
            success: function (data) {
                if(data==1){
                    alert("拆分成功");
                    document.getElementById("btn_"+rid).innerHTML="已拆分";
                    $("#tbody_"+rid).addClass("ee");
                    //document.getElementById("btn_"+rid).remove();
                }
            }
        });
    }









    function preserve(){
        var flag=false;
        var emptyArr = [],manage=[];
        var ids=document.getElementsByName("ids[]");
        for (let index = 0; index < ids.length; index++) {
            var res_sum=0;
            var id=ids[index].value;
            var rids=document.getElementsByName("resource["+id+"][]");
            for (let i = 0; i < rids.length; i++) {
                var sum=0;
                var id_arr=rids[i].id.split("_");
                var did=id_arr[1];
                var num_arr=rids[i].value.split(",");
                for(let j = 0; j < num_arr.length; j++){
                    sum=accAdd(sum,num_arr[j]);
                    res_sum=accAdd(res_sum,num_arr[j]);
                }
                if(sum>detailIds[did]){
                    flag=true;
                    emptyArr.push(did);
                }
                manage.push([did,rids[i].value]);
            }

            if(res_sum>resIds[id] && res_sum>0){
                alert("分配资源量大于资源上架量！");
                for(var i=0;i<rids.length;i++){
                    rids[i].style.borderColor = "red";
                }
                
            }
        }

        $("#stab input").css('border-color', "#dedede");
        if(flag){
            alert("分配资源量大于订单量！");
            for(var k=0;k<emptyArr.length;k++){
                $("#resource_"+emptyArr[k]).css('border-color', "red");
            }
            
        }

        console.log(manage);
        $.ajax({
            type: "POST",
            url: "/scorderlist/setPurchase",
            dataType: "json",
            async:false,
            data: {
                "manage":JSON.stringify(manage),
                "[[${_csrf.parameterName}]]": "[[${_csrf.token}]]"
            },
            success: function (data) {
                console.log(data);
            }
        });



    }

    

    

    //加法
    function accAdd(arg1,arg2){
        var r1,r2,m;
        try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}
        try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}
        m=Math.pow(10,Math.max(r1,r2))
        return (arg1*m+arg2*m)/m
    }

    //减法
    function accSub(arg1,arg2){
        var r1,r2,m,n;
        try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}
        try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}
        m=Math.pow(10,Math.max(r1,r2));
        n=(r1>=r2)?r1:r2;
        return ((arg1*m-arg2*m)/m).toFixed(n);
    }


    function objToArr(obj) {
        var arr = []
        for (let i in obj) {
            let o = {};
            o[i] = obj[i];
            arr.push(o)

        }
        return arr;
    }


    function removestr(obj){
        //通过this找到父级元素节点
        var tr = obj.parentNode.parentNode;

        //console.log(obj.parentNode.parentNode.sectionRowIndex);

        if(obj.parentNode.parentNode.sectionRowIndex==1){
            var hh=obj.parentNode.parentNode.children[obj.parentNode.parentNode.children.length-1];
        }
        //找到表格
        var tbody = tr.parentNode;
        //删除行
        tbody.removeChild(tr);
        
        if(hh!=""){
            obj.parentNode.parentNode.append(hh)
        }
        if(tbody.children.length==2){
            tbody.remove();
        }
    }

    function find(pageNum) {
        document.getElementById('form1').submit();
    }
</script>

</html>